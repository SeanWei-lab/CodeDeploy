/**
 * Created by A.J on 2016/10/7.
 */
$(document).ready(function(){$("#fabushijian").length>0&&$("#fabushijian").datetimepicker({format:"yyyy-mm-dd hh:ii:ss"});var e="",a="",i="";if(e=$("#suolvetu").html(),""!=$("#slt").val()&&($("#suolvetu img").attr("src",$("#slt").val()),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),""!=$("#fujian").val()){var t=$("#fujian").val().split("|");$("#fujianuploaddiv").html(""),$.each(t,function(e,a){var i=a.split(":"),t=$("#fujiandiv").html().replace("#fujianming#",i[1]).replace("#fujianurl#",i[0]);$("#fujianuploaddiv").append(t)})}$("#upload").uploadify({auto:!0,fileTypeExts:"*.jpg;*.png;*.gif;*.jpeg",multi:!1,formData:{},fileSizeLimit:9999,buttonText:$("#buttonText").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:"upload",onUploadComplete:function(e,i){a=$("#webroot").text()+"data/uploads/"+i.replace("\\","/"),$("#bendi .panel-body").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">')}}),$("#queding").click(function(){e=$("#suolvetu").html(),$("#xuanbendi").hasClass("active")&&""!=a?($("#suolvetu").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(a).trigger("change")):$("#xuanwangluo").hasClass("active")&&""!=i&&($("#suolvetu").html('<img src="'+i+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(i).trigger("change")),""==a&&""==i||($("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),$("#myModal").modal("hide")}),$("#quxiaotu").click(function(){$("#suolvetu").html(e),$("#slt").val("").trigger("change"),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")}),$("#wangluodizhi").change(function(){i=$("#wangluodizhi").val(),$("#wangluo .panel-body").html('<img src="'+i+'" class="img-responsive" alt="Responsive image">')}),$("#templatex").html(remark[$("#template").val()]),$("#template").change(function(){remark[$("#template").val()]?$("#templatex").html(remark[$("#template").val()]):$("#templatex").html("")}),""!=$("#fenlei").val()&&$("#meiyexianshidiv").removeClass("hidden"),$("#fenlei").change(function(){""!=$("#fenlei").val()?$("#meiyexianshidiv").removeClass("hidden"):$("#meiyexianshidiv").addClass("hidden")});var n=$("#pagename").text(),l=!1,o=jLos.open(0,5e3);if(o.isValid&&$("#catfish").length>0){if(l=!0,"1"==$("#issaved").text())o.remove(n);else{var s=o.get(n);if(""!=s&&"object"==typeof s&&s.id==$("#pid").val()){if($("#biaoti").val(s.biaoti),$("#template option[value='"+s.template+"']").prop("selected",!0),$("#templatex").html(remark[$("#template").val()]),$("#zuozhe").val(s.zuozhe),$("#bianji").val(s.bianji),$("#guanjianci").val(s.guanjianci),$("#zhaiyao").val(s.zhaiyao),$("#fenlei option[value='"+s.fenlei+"']").prop("selected",!0),""!=s.fenlei?$("#meiyexianshidiv").removeClass("hidden"):$("#meiyexianshidiv").addClass("hidden"),$("#meiyexianshi").val(s.meiyexianshi),$("#fujian").val(s.fujian),$("#fujianurl").val(s.fujianurl),""!=s.fujian){t=s.fujian.split("|");$("#fujianuploaddiv").html(""),$.each(t,function(e,a){var i=a.split(":"),t=$("#fujiandiv").html().replace("#fujianming#",i[1]).replace("#fujianurl#",i[0]);$("#fujianuploaddiv").append(t)})}""!=s.slt?($("#slt").val(s.slt),$("#suolvetu img").attr("src",s.slt),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")):($("#suolvetu").html(e),$("#slt").val(""),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")),$("#fabushijian").length>0&&$("#fabushijian").val(s.fabushijian),window.onload=function(){$.setEditorContent(s.neirong)}}}$(document).keyup(function(e){$.record(n)}),$("#template, #fenlei, #fabushijian, #slt").on("change",function(){$.record(n)}),$(document).on("click",function(e){setTimeout(function(){$.record(n)},0)}),$("#push").confirm({title:$("#quedingtuisong").text(),content:$("#tuisongshuoming").text(),confirmButton:$("#jixu").text(),cancelButton:$("#quxiao").text(),confirm:function(){var e=this.$target;e.children("span:last").removeClass("hidden"),$.post("writepush",{act:"push",name:n,pid:$("#pid").val(),jval:JSON.stringify(o.get(n)),verification:$("#verification").text()},function(a){if(e.children("span:last").addClass("hidden"),"ok"==a.result){var i=$.alert({title:"",content:$("#yituisong").text(),confirmButton:$("#ok").text()});setTimeout(function(){i.close()},1e3)}else $.alert({title:$("#chucuo").text(),content:a.message,confirmButton:$("#ok").text()})})}}),$("#pull").on("click",function(e){var a=$(this);a.children("span:last").removeClass("hidden"),$.post("writepull",{act:"pull",name:n,pid:$("#pid").val(),verification:$("#verification").text()},function(e){if(a.children("span:last").addClass("hidden"),"ok"==e.result){var i=JSON.parse(e.value);o.set(n,i);var t=$.alert({title:"",content:$("#lacheng").text(),confirmButton:$("#ok").text()});setTimeout(function(){t.close(),window.location.reload()},1e3)}else $.alert({title:$("#shibai").text(),content:e.message,confirmButton:$("#ok").text()})})})}if($("#fujianupload").uploadify({auto:!0,fileTypeExts:"*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.mp3;*.mp4;*.txt;*.zip;*.rar;*.gz;*.bz2;*.pdf;*.apk;*.swf",multi:!1,formData:{act:"fujianupload"},fileSizeLimit:999999,buttonText:$("#choosefile").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:"fujianupload",onUploadComplete:function(e,a){if("ok"==(a=JSON.parse(a)).result){var i=$("#fujiandiv").html().replace("#fujianming#",a.info.name).replace("#fujianurl#",a.message);$("#fujianuploaddiv").append(i),""==$("#fujian").val()?$("#fujian").val(a.message+":"+a.info.name):$("#fujian").val($("#fujian").val()+"|"+a.message+":"+a.info.name),l&&$.record(n)}else $.alert({title:$("#shibai").text(),content:a.message,confirmButton:$("#ok").text()})}}),$('[data-toggle="popover"]').popover(),$("#fujianuploaddiv").on("click",".shanchufujian",function(e){var a=$(this);a.next("span").removeClass("hidden");var i=$(this).parent().children(":last").text();$.post("shanchufujian",{act:"shanchufujian",fujianming:i},function(e){if(a.next("span").addClass("hidden"),"ok"==e.result){var t="",o=$("#fujian").val().split("|");$.each(o,function(e,a){a.split(":")[0]!=i&&(""==t?t=a:t+="|"+a)}),$("#fujian").val(t),a.parent().parent().parent().parent().remove(),l&&$.record(n)}else $.alert({title:$("#chucuo").text(),content:e.message,confirmButton:$("#ok").text()})})}),$.isFunction($.getQueryString)){var u=$.getQueryString(["editor"]);""!=u&&$("#switchEditor").attr("href",$("#switchEditor").attr("href")+"&"+u)}""==$("#zuozhe").val()&&""==$("#bianji").val()&&$.post("getnick",{act:"getnick",verification:$("#verification").text()},function(e){""==$("#zuozhe").val()&&""==$("#bianji").val()&&($("#zuozhe").val(e),$("#bianji").val(e))}),$.extend({record:function(e){var a={};a.id=$("#pid").val(),a.biaoti=$("#biaoti").val(),a.template=$("#template").val(),a.neirong=$.getEditorContent(),a.zuozhe=$("#zuozhe").val(),a.bianji=$("#bianji").val(),a.guanjianci=$("#guanjianci").val(),a.zhaiyao=$("#zhaiyao").val(),a.fenlei=$("#fenlei").val(),a.meiyexianshi=$("#meiyexianshi").val(),a.fujian=$("#fujian").val(),a.fujianurl=$("#fujianurl").val(),a.slt=$("#slt").val(),$("#fabushijian").length>0&&(a.fabushijian=$("#fabushijian").val()),o.set(e,a)}})});
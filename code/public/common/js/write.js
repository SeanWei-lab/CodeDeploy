/**
 * Created by A.J on 2016/10/2.
 */
$(document).ready(function(){$("#fabushijian").length>0&&$("#fabushijian").datetimepicker({format:"yyyy-mm-dd hh:ii:ss"});var e="",t="",a="";if(e=$("#suolvetu").html(),""!=$("#slt").val()&&($("#suolvetu img").attr("src",$("#slt").val()),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),""!=$("#fujian").val()){var i=$("#fujian").val().split("|");$("#fujianuploaddiv").html(""),$.each(i,function(e,t){var a=t.split(":"),i=$("#fujiandiv").html().replace("#fujianming#",a[1]).replace("#fujianurl#",a[0]);$("#fujianuploaddiv").append(i)})}$("#upload").uploadify({auto:!0,fileTypeExts:"*.jpg;*.png;*.gif;*.jpeg",multi:!1,formData:{upload:1},fileSizeLimit:9999,buttonText:$("#buttonText").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:$("#upload_url").text(),onUploadComplete:function(e,a){t=$("#webroot").text()+"data/uploads/"+a.replace("\\","/"),$("#bendi .panel-body").html('<img src="'+t+'" class="img-responsive" alt="Responsive image">')}}),$("#queding").click(function(){e=$("#suolvetu").html(),$("#xuanbendi").hasClass("active")&&""!=t?($("#suolvetu").html('<img src="'+t+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(t).trigger("change")):$("#xuanwangluo").hasClass("active")&&""!=a&&($("#suolvetu").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(a).trigger("change")),""==t&&""==a||($("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")),$("#myModal").modal("hide")}),$("#quxiaotu").click(function(){$("#suolvetu").html(e),$("#slt").val("").trigger("change"),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")}),$("#wangluodizhi").change(function(){a=$("#wangluodizhi").val(),$("#wangluo .panel-body").html('<img src="'+a+'" class="img-responsive" alt="Responsive image">'),$("#slt").val(a).trigger("change")}),$("#newv").length>0&&"1"==$("#newv").text()&&$.post("detection",function(e){"show"==e&&$("#jiancexinban").removeClass("hidden")}),$("#guanbi").click(function(){$("#jiancexinban").remove()}),$("#butixing").click(function(){$("#jiancexinban").addClass("hidden"),$.post("aweek",{})});var n=$("#writename").text(),l=jLos.open(0,5e3),o=!1;if(l.isValid&&$("#catfish").length>0){if(o=!0,"1"==$("#issaved").text())l.remove(n);else{var s=l.get(n);if(""!=s&&"object"==typeof s&&s.id==$("#pid").val()){if($("#biaoti").val(s.biaoti),$("#zuozhe").val(s.zuozhe),$("#bianji").val(s.bianji),$("#guanjianci").val(s.guanjianci),$("#laiyuan").val(s.laiyuan),$("#zhaiyao").val(s.zhaiyao),$("#fujian").val(s.fujian),$("#fujianurl").val(s.fujianurl),""!=s.fujian){i=s.fujian.split("|");$("#fujianuploaddiv").html(""),$.each(i,function(e,t){var a=t.split(":"),i=$("#fujiandiv").html().replace("#fujianming#",a[1]).replace("#fujianurl#",a[0]);$("#fujianuploaddiv").append(i)})}""!=s.slt?($("#slt").val(s.slt),$("#suolvetu img").attr("src",s.slt),$("#shangchuantu").addClass("hidden"),$("#quxiaotu").removeClass("hidden")):($("#suolvetu").html(e),$("#slt").val(""),$("#quxiaotu").addClass("hidden"),$("#shangchuantu").removeClass("hidden")),$("#fabushijian").length>0&&$("#fabushijian").val(s.fabushijian);var u=s.fenlei;""!=u&&(u=u.split(","),$("#fenlei option").each(function(){$.inArray($(this).val(),u)>-1&&$(this).prop("selected",!0)})),$("input[type='radio'][name='zhiding'][value="+s.zhiding+"]").prop("checked",!0),$("input[type='radio'][name='tuijian'][value="+s.tuijian+"]").prop("checked",!0),$("input[type='radio'][name='pinglun'][value="+s.pinglun+"]").prop("checked",!0),$("input[type='radio'][name='xingshi'][value="+s.xingshi+"]").prop("checked",!0),$("#simiwenzhang").prop("checked",s.simiwenzhang),window.onload=function(){$.setEditorContent(s.neirong)}}}$(document).keyup(function(e){$.record(n)}),$("#fenlei, #fabushijian, #slt, input[type='radio']").on("change",function(){$.record(n)}),$(document).on("click",function(e){setTimeout(function(){$.record(n)},0)}),$("#push").confirm({title:$("#quedingtuisong").text(),content:$("#tuisongshuoming").text(),confirmButton:$("#jixu").text(),cancelButton:$("#quxiao").text(),confirm:function(){var e=this.$target;e.children("span:last").removeClass("hidden"),$.post("writepush",{act:"push",name:n,pid:$("#pid").val(),jval:JSON.stringify(l.get(n))},function(t){if(e.children("span:last").addClass("hidden"),"ok"==t.result){var a=$.alert({title:"",content:$("#yituisong").text(),confirmButton:$("#ok").text()});setTimeout(function(){a.close()},1e3)}else $.alert({title:$("#chucuo").text(),content:t.message,confirmButton:$("#ok").text()})})}}),$("#pull").on("click",function(e){var t=$(this);t.children("span:last").removeClass("hidden"),$.post("writepull",{act:"pull",name:n,pid:$("#pid").val()},function(e){if(t.children("span:last").addClass("hidden"),"ok"==e.result){var a=JSON.parse(e.value);l.set(n,a);var i=$.alert({title:"",content:$("#lacheng").text(),confirmButton:$("#ok").text()});setTimeout(function(){i.close(),window.location.reload()},1e3)}else $.alert({title:$("#shibai").text(),content:e.message,confirmButton:$("#ok").text()})})})}if($("#fujianupload").uploadify({auto:!0,fileTypeExts:"*.doc;*.docx;*.xls;*.xlsx;*.ppt;*.mp3;*.mp4;*.txt;*.zip;*.rar;*.gz;*.bz2;*.pdf;*.apk;*.swf",multi:!1,formData:{act:"fujianupload"},fileSizeLimit:999999,buttonText:$("#choosefile").text(),showUploadedPercent:!0,showUploadedSize:!1,removeTimeout:3,uploader:"fujianupload",onUploadComplete:function(e,t){if("ok"==(t=JSON.parse(t)).result){var a=$("#fujiandiv").html().replace("#fujianming#",t.info.name).replace("#fujianurl#",t.message);$("#fujianuploaddiv").append(a),""==$("#fujian").val()?$("#fujian").val(t.message+":"+t.info.name):$("#fujian").val($("#fujian").val()+"|"+t.message+":"+t.info.name),o&&$.record(n)}else $.alert({title:$("#shibai").text(),content:t.message,confirmButton:$("#ok").text()})}}),$('[data-toggle="popover"]').popover(),$("#fujianuploaddiv").on("click",".shanchufujian",function(e){var t=$(this);t.next("span").removeClass("hidden");var a=$(this).parent().children(":last").text();$.post("shanchufujian",{act:"shanchufujian",fujianming:a},function(e){if(t.next("span").addClass("hidden"),"ok"==e.result){var i="",l=$("#fujian").val().split("|");$.each(l,function(e,t){t.split(":")[0]!=a&&(""==i?i=t:i+="|"+t)}),$("#fujian").val(i),t.parent().parent().parent().parent().remove(),o&&$.record(n)}else $.alert({title:$("#chucuo").text(),content:e.message,confirmButton:$("#ok").text()})})}),$.isFunction($.getQueryString)){var d=$.getQueryString(["editor"]);""!=d&&$("#switchEditor").attr("href",$("#switchEditor").attr("href")+"&"+d)}$("#savetemplatebutton").on("click",function(e){var t=$(this);t.children("span").removeClass("hidden"),$("#savetemplateload").removeClass("hidden"),$.post("savetemplate",{act:"savetemplate",mid:$("#savetemplate").data("mid"),name:$("#templatename").val(),content:$.getEditorContent()},function(e){if(t.children("span").addClass("hidden"),$("#savetemplateload").addClass("hidden"),"ok"==e.result){$("#savetemplate-modal").modal("hide"),$("#templatename").val("");var a=$.alert({title:"",content:e.message,confirmButton:$("#ok").text()});setTimeout(function(){a.close()},1e3)}else $.alert({title:$("#shibai").text(),content:e.message,confirmButton:$("#ok").text()})})}),$("#choosetemplate").on("click",function(e){$("#choosetemplatecontent").html($("#choosetemplateload").html()),$.post("loadtemplate",{act:"loadtemplate"},function(e){if("ok"==e.result){var t="",a="",i=3;$.each(e.message,function(e,n){a+=$("#mubandiv").html().replace("#name#",n.tname).replace("#iddiv#",n.id).replace("#yulandiv#",n.tcontent),--i<=0&&(i=3,t+='<div class="row">'+a+"</div>",a="")}),""!=a&&(t+='<div class="row">'+a+"</div>"),$("#choosetemplatecontent").html('<div class="container-fluid">'+t+"</div>")}else $("#choosetemplate-modal").modal("hide"),$.alert({title:$("#shibai").text(),content:e.message,confirmButton:$("#ok").text()})})}),$("#choosetemplatecontent").on("click",".yulan",function(e){$("#yulancontent").html($(this).parent().siblings("div:last").html()),$("#yulancontentid").text($(this).parent().siblings("div:first").text()),$("#yulancontentname").text($(this).parent().parent().siblings("div:first").text()),$("#choosetemplate-modal").modal("hide"),$("#yulan-modal").modal("show")}),$("#yulancontentclose, #yulanfanhui").on("click",function(e){$("#yulan-modal").modal("hide"),$("#choosetemplate-modal").modal("show")}),$("#choosetemplatecontent").on("click",".shiyong",function(e){$.setEditorContent($(this).parent().siblings("div:last").html()),$("#savetemplate").length>0&&($("#savetemplate").data("mid",$(this).parent().siblings("div:first").text()),$("#savetemplate").data("name",$(this).parent().parent().siblings("div:first").text())),$("#choosetemplate-modal").modal("hide")}),$("#shiyongtemp").on("click",function(e){$.setEditorContent($("#yulancontent").html()),$("#savetemplate").length>0&&($("#savetemplate").data("mid",$("#yulancontentid").text()),$("#savetemplate").data("name",$("#yulancontentname").text())),$("#yulan-modal").modal("hide")}),$("#savetemplate-modal").on("show.bs.modal",function(e){$("#savetemplate").length>0&&$("#templatename").val($("#savetemplate").data("name"))}),$("#laiyuanqueding").on("click",function(e){$("#laiyuan").val("<a href='"+$("#laiyuandizhi").val()+"' target='_blank'>"+$("#laiyuanming").val()+"</a>"),$.record(n),$("#laiyuanhtml").modal("hide")}),""==$("#zuozhe").val()&&""==$("#bianji").val()&&$.post("getnick",{act:"getnick",verification:$("#verification").text()},function(e){""==$("#zuozhe").val()&&""==$("#bianji").val()&&($("#zuozhe").val(e),$("#bianji").val(e))}),$.extend({record:function(e){var t={};t.id=$("#pid").val(),t.biaoti=$("#biaoti").val(),t.neirong=$.getEditorContent(),t.zuozhe=$("#zuozhe").val(),t.bianji=$("#bianji").val(),t.guanjianci=$("#guanjianci").val(),t.laiyuan=$("#laiyuan").val(),t.zhaiyao=$("#zhaiyao").val(),t.fujian=$("#fujian").val(),t.fujianurl=$("#fujianurl").val(),t.slt=$("#slt").val(),$("#fabushijian").length>0&&(t.fabushijian=$("#fabushijian").val());var a="";$("#fenlei option:selected").each(function(){""==a?a=$(this).val():a+=","+$(this).val()}),t.fenlei=a;var i=$("input[type='radio'][name='zhiding']:checked").val(),n=$("input[type='radio'][name='tuijian']:checked").val(),o=$("input[type='radio'][name='pinglun']:checked").val(),s=$("input[type='radio'][name='xingshi']:checked").val();t.zhiding=i,t.tuijian=n,t.pinglun=o,t.xingshi=s,t.simiwenzhang=$("#simiwenzhang").prop("checked"),l.set(e,t)}})});